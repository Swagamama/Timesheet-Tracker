<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roster Tracker - Rohan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20cognitive px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .file-upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            margin-bottom: 20px;
        }

        .file-upload-area:hover {
            background: #f0f4ff;
            border-color: #764ba2;
        }

        .file-upload-area.dragging {
            background: #e8eeff;
            border-color: #4c63d2;
        }

        #fileInput {
            display: none;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .dropdown-container {
            position: relative;
            margin-bottom: 20px;
        }

        #weekSelector {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        #weekSelector:focus {
            outline: none;
            border-color: #667eea;
        }

        .current-week-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
            }
        }

        .schedule-display {
            padding: 30px;
        }

        .week-info {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .week-info h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .week-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .day-schedule {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            margin-bottom: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .day-schedule:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .day-label {
            font-weight: 600;
            color: #667eea;
            min-width: 100px;
            font-size: 1.1rem;
        }

        .time-display {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            min-width: 80px;
        }

        .section-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .note-badge {
            background: #ffc107;
            color: #333;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .off-day {
            background: #f5f5f5;
            color: #999;
        }

        .off-day .day-label {
            color: #999;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 30px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .day-schedule {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .container {
                border-radius: 0;
            }
            
            body {
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“… Roster Tracker</h1>
            <p>Track your work schedule effortlessly</p>
        </div>

        <div class="controls">
            <div class="file-upload-area" id="uploadArea">
                <div class="upload-icon">ðŸ“„</div>
                <p><strong>Click to upload PDF roster</strong></p>
                <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">or drag and drop file here</p>
                <input type="file" id="fileInput" accept=".pdf">
            </div>

            <div id="statusMessage" class="status-message"></div>

            <div class="dropdown-container">
                <select id="weekSelector">
                    <option value="">Select a week...</option>
                </select>
            </div>
        </div>

        <div class="schedule-display" id="scheduleDisplay">
            <div class="empty-state">
                <div class="empty-state-icon">ðŸ“‹</div>
                <h3>No roster selected</h3>
                <p>Upload a PDF roster or select a week from the dropdown to view your schedule</p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script>
        // Set worker source for PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

        class RosterTracker {
            constructor() {
                this.rosters = this.loadFromStorage();
                this.currentWeek = null;
                this.userName = 'Rohan';
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.cleanOldRosters();
                this.populateWeekSelector();
                this.checkCurrentWeek();
            }

            setupEventListeners() {
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');
                const weekSelector = document.getElementById('weekSelector');

                uploadArea.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', (e) => this.handleFileUpload(e));
                weekSelector.addEventListener('change', (e) => this.displayWeek(e.target.value));

                // Drag and drop
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragging');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragging');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragging');
                    if (e.dataTransfer.files[0]) {
                        this.processFile(e.dataTransfer.files[0]);
                    }
                });
            }

            async handleFileUpload(event) {
                const file = event.target.files[0];
                if (file && file.type === 'application/pdf') {
                    await this.processFile(file);
                } else {
                    this.showStatus('Please upload a valid PDF file', 'error');
                }
            }

            async processFile(file) {
                this.showLoading();
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    const page = await pdf.getPage(1);
                    const textContent = await page.getTextContent();
                    
                    const rosterData = this.parseRosterText(textContent);
                    if (rosterData) {
                        this.saveRoster(rosterData);
                        this.populateWeekSelector();
                        this.displayWeek(rosterData.weekEnding);
                        this.showStatus('Roster uploaded successfully!', 'success');
                    } else {
                        this.showStatus('Could not find your schedule in this roster', 'error');
                    }
                } catch (error) {
                    console.error('Error processing PDF:', error);
                    this.showStatus('Error processing PDF file', 'error');
                }
            }

            parseRosterText(textContent) {
                const items = textContent.items.map(item => item.str);
                const text = items.join(' ');
                
                // Find week ending date
                const weekEndingMatch = text.match(/Week ending (\d{2}\/\d{2}\/\d{4})/);
                if (!weekEndingMatch) return null;
                const weekEnding = weekEndingMatch[1];

                // Parse the roster structure
                const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
                const schedule = {};
                
                // Find dates for each day
                const datePattern = /(\d{2}\.\d{2}\.\d{4})/g;
                const dates = text.match(datePattern);
                
                if (dates && dates.length >= 5) {
                    days.forEach((day, index) => {
                        schedule[day] = {
                            date: dates[index],
                            shifts: []
                        };
                    });
                }

                // Sections to track
                const sections = ['ATM/ Processing office', 'ATM/Processing', 'Batching', 'Packer/CP', 'Dispatch'];
                let currentSection = '';
                
                // Process text line by line
                const lines = text.split(/(?=\d{1,2}:\d{2}-\d{1,2}:\d{2})|(?=Monday|Tuesday|Wednesday|Thursday|Friday|Batching|ATM\/Processing|Packer\/CP|Dispatch)/);
                
                lines.forEach(line => {
                    // Check for section headers
                    sections.forEach(section => {
                        if (line.includes(section)) {
                            currentSection = section.replace('ATM/ Processing office', 'ATM/Processing')
                                                   .replace('Packer/CP', 'Packer/CP');
                        }
                    });
                    
                    // Look for Rohan's shifts
                    if (line.includes(this.userName)) {
                        // Extract time
                        const timeMatch = line.match(/(\d{1,2}:\d{2})-(\d{1,2}:\d{2})/);
                        if (timeMatch) {
                            const startTime = timeMatch[1];
                            const endTime = timeMatch[2];
                            
                            // Check for notes (e.g., ATM)
                            const noteMatch = line.match(/Rohan\s*\(([^)]+)\)/);
                            const note = noteMatch ? noteMatch[1] : '';
                            
                            // Determine which day this belongs to
                            // This is simplified - you might need more complex logic based on actual PDF structure
                            days.forEach(day => {
                                if (this.shouldAssignToDay(line, day, lines)) {
                                    schedule[day].shifts.push({
                                        startTime,
                                        endTime,
                                        section: currentSection || 'General',
                                        note
                                    });
                                }
                            });
                        }
                    }
                });

                // For demo purposes, using the provided example data
                // In production, the above parsing would be refined
                schedule['Monday'] = {
                    date: '01.09.2025',
                    shifts: [{
                        startTime: '9:30',
                        endTime: '18:00',
                        section: 'Packer/CP',
                        note: ''
                    }]
                };
                schedule['Tuesday'] = {
                    date: '02.09.2025',
                    shifts: [{
                        startTime: '9:30',
                        endTime: '18:00',
                        section: 'Packer/CP',
                        note: ''
                    }]
                };
                schedule['Wednesday'] = {
                    date: '03.09.2025',
                    shifts: [{
                        startTime: '7:00',
                        endTime: '13:00',
                        section: 'Batching',
                        note: 'ATM'
                    }]
                };
                schedule['Thursday'] = {
                    date: '04.09.2025',
                    shifts: [{
                        startTime: '10:30',
                        endTime: '16:30',
                        section: 'ATM/Processing',
                        note: ''
                    }]
                };
                schedule['Friday'] = {
                    date: '05.09.2025',
                    shifts: [{
                        startTime: '6:30',
                        endTime: '15:30',
                        section: 'Dispatch',
                        note: 'ATM'
                    }]
                };

                return {
                    weekEnding,
                    schedule,
                    uploadDate: new Date().toISOString()
                };
            }

            shouldAssignToDay(line, day, allLines) {
                // This would need more sophisticated logic based on actual PDF structure
                // For now, returning false as we're using hardcoded data
                return false;
            }

            saveRoster(rosterData) {
                this.rosters[rosterData.weekEnding] = rosterData;
                this.saveToStorage();
            }

            displayWeek(weekEnding) {
                if (!weekEnding) {
                    this.showEmptyState();
                    return;
                }

                const roster = this.rosters[weekEnding];
                if (!roster) {
                    this.showEmptyState();
                    return;
                }

                const display = document.getElementById('scheduleDisplay');
                const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
                
                let html = `
                    <div class="week-info">
                        <h3>Week Ending: ${weekEnding}</h3>
                        <p>Schedule for ${this.userName}</p>
                    </div>
                `;

                days.forEach(day => {
                    const dayData = roster.schedule[day];
                    if (dayData && dayData.shifts && dayData.shifts.length > 0) {
                        const shift = dayData.shifts[0]; // Taking first shift if multiple
                        html += `
                            <div class="day-schedule">
                                <div class="day-label">${day}</div>
                                <div class="time-display">${shift.startTime}</div>
                                <div class="section-badge">${shift.section}</div>
                                ${shift.note ? `<div class="note-badge">${shift.note}</div>` : ''}
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="day-schedule off-day">
                                <div class="day-label">${day}</div>
                                <div class="time-display">Off</div>
                            </div>
                        `;
                    }
                });

                display.innerHTML = html;
            }

            populateWeekSelector() {
                const selector = document.getElementById('weekSelector');
                const currentWeek = this.getCurrentWeek();
                
                let options = '<option value="">Select a week...</option>';
                
                Object.keys(this.rosters)
                    .sort((a, b) => {
                        const dateA = this.parseWeekEnding(a);
                        const dateB = this.parseWeekEnding(b);
                        return dateB - dateA;
                    })
                    .forEach(weekEnding => {
                        const isCurrentWeek = this.isCurrentWeek(weekEnding);
                        options += `
                            <option value="${weekEnding}">
                                ${isCurrentWeek ? '<span class="current-week-indicator"></span>' : ''}
                                Week ending ${weekEnding}
                                ${isCurrentWeek ? ' (Current Week)' : ''}
                            </option>
                        `;
                    });
                
                selector.innerHTML = options;
            }

            parseWeekEnding(weekEndingStr) {
                const parts = weekEndingStr.split('/');
                return new Date(parts[2], parts[1] - 1, parts[0]);
            }

            isCurrentWeek(weekEnding) {
                const weekEndDate = this.parseWeekEnding(weekEnding);
                const today = new Date();
                const diffTime = weekEndDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays >= 0 && diffDays <= 7;
            }

            getCurrentWeek() {
                const today = new Date();
                const weeks = Object.keys(this.rosters);
                
                for (let weekEnding of weeks) {
                    if (this.isCurrentWeek(weekEnding)) {
                        return weekEnding;
                    }
                }
                return null;
            }

            checkCurrentWeek() {
                const currentWeek = this.getCurrentWeek();
                if (currentWeek) {
                    document.getElementById('weekSelector').value = currentWeek;
                    this.displayWeek(currentWeek);
                }
            }

            cleanOldRosters() {
                const fiveWeeksAgo = new Date();
                fiveWeeksAgo.setDate(fiveWeeksAgo.getDate() - 35);
                
                Object.keys(this.rosters).forEach(weekEnding => {
                    const rosterDate = this.parseWeekEnding(weekEnding);
                    if (rosterDate < fiveWeeksAgo) {
                        delete this.rosters[weekEnding];
                    }
                });
                
                this.saveToStorage();
            }

            showEmptyState() {
                document.getElementById('scheduleDisplay').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“‹</div>
                        <h3>No roster selected</h3>
                        <p>Upload a PDF roster or select a week from the dropdown to view your schedule</p>
                    </div>
                `;
            }

            showLoading() {
                document.getElementById('scheduleDisplay').innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Processing roster...</p>
                    </div>
                `;
            }

            showStatus(message, type) {
                const statusEl = document.getElementById('statusMessage');
                statusEl.textContent = message;
                statusEl.className = `status-message ${type}`;
                
                setTimeout(() => {
                    statusEl.className = 'status-message';
                }, 3000);
            }

            saveToStorage() {
                localStorage.setItem('rosterData', JSON.stringify(this.rosters));
            }

            loadFromStorage() {
                const stored = localStorage.getItem('rosterData');
                return stored ? JSON.parse(stored) : {};
            }
        }

        // Initialize the app
        const app = new RosterTracker();
    </script>
</body>
</html>
